{"ast":null,"code":"/*global chrome*/import{checkReadability}from\"./checkReadability\";import{getUserInfo}from\"./cookies\";import{useState,useEffect}from\"react\";import Zeeguu_API from\"../../../../src/api/Zeeguu_API\";import{getSourceAsDOM}from\"./functions\";import{isProbablyReaderable}from\"@mozilla/readability\";import logo from\"../images/zeeguu128.png\";import{HeadingContainer,PopUp,BottomContainer}from\"./Popup.styles\";import PopupContent from\"./PopupContent\";import{EXTENSION_SOURCE}from\"../JSInjection/constants\";import{checkLanguageSupport,setUserInLocalStorage}from\"./functions\";import{StyledPrimaryButton}from\"../JSInjection/Modal/Buttons.styles\";import{API_URL,WEB_URL}from\"../../../../src/config\";import{BROWSER_API}from\"../utils/browserApi\";//for isProbablyReadable options object\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const minLength=120;const minScore=20;export default function Popup(_ref){let{loggedIn}=_ref;let api=new Zeeguu_API(API_URL);const[user,setUser]=useState();const[tab,setTab]=useState();const[isReadable,setIsReadable]=useState();const[languageSupported,setLanguageSupported]=useState();useEffect(()=>{if(loggedIn){getUserInfo(WEB_URL,setUser);}},[loggedIn]);useEffect(()=>{setUserInLocalStorage(user,api);},[user]);useEffect(()=>{BROWSER_API.tabs.query({active:true,currentWindow:true},tabs=>{setTab(tabs[0]);});},[]);useEffect(()=>{if(tab!==undefined&&user!==undefined){api.session=user.session;api.logUserActivity(api.OPEN_POPUP,\"\",tab.url,EXTENSION_SOURCE);// Readability check and language check\nconst documentFromTab=getSourceAsDOM(tab.url);const isProbablyReadable=isProbablyReaderable(documentFromTab,minLength,minScore);const ownIsProbablyReadable=checkReadability(tab.url);if(!isProbablyReadable||!ownIsProbablyReadable){setIsReadable(false);setLanguageSupported(false);}else{setIsReadable(true);api.session=user.session;if(api.session!==undefined){checkLanguageSupport(api,tab,setLanguageSupported);}}}},[tab,user]);const openLogin=()=>{window.open(WEB_URL+\"/log_in\",\"_blank\");};if(loggedIn===false){return/*#__PURE__*/_jsxs(PopUp,{children:[/*#__PURE__*/_jsx(HeadingContainer,{children:/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"Zeeguu logo\"})}),/*#__PURE__*/_jsx(BottomContainer,{children:/*#__PURE__*/_jsx(StyledPrimaryButton,{onClick:openLogin,name:\"toLogin\",className:\"toLoginButton\",children:\"Login\"})})]});}else{if(user===undefined||isReadable===undefined){return null;}else{return/*#__PURE__*/_jsx(PopUp,{children:/*#__PURE__*/_jsx(PopupContent,{isReadable:isReadable,languageSupported:languageSupported,user:user,tab:tab,api:api,sessionId:user.session})});}}}","map":{"version":3,"names":["checkReadability","getUserInfo","useState","useEffect","Zeeguu_API","getSourceAsDOM","isProbablyReaderable","logo","HeadingContainer","PopUp","BottomContainer","PopupContent","EXTENSION_SOURCE","checkLanguageSupport","setUserInLocalStorage","StyledPrimaryButton","API_URL","WEB_URL","BROWSER_API","jsx","_jsx","jsxs","_jsxs","minLength","minScore","Popup","_ref","loggedIn","api","user","setUser","tab","setTab","isReadable","setIsReadable","languageSupported","setLanguageSupported","tabs","query","active","currentWindow","undefined","session","logUserActivity","OPEN_POPUP","url","documentFromTab","isProbablyReadable","ownIsProbablyReadable","openLogin","window","open","children","src","alt","onClick","name","className","sessionId"],"sources":["/Users/gh/zeeguu/js/web/extension/src/popup/Popup.js"],"sourcesContent":["/*global chrome*/\nimport { checkReadability } from \"./checkReadability\";\nimport { getUserInfo } from \"./cookies\";\nimport { useState, useEffect } from \"react\";\nimport Zeeguu_API from \"../../../../src/api/Zeeguu_API\";\nimport { getSourceAsDOM } from \"./functions\";\nimport { isProbablyReaderable } from \"@mozilla/readability\";\nimport logo from \"../images/zeeguu128.png\";\nimport { HeadingContainer, PopUp, BottomContainer } from \"./Popup.styles\";\nimport PopupContent from \"./PopupContent\";\nimport { EXTENSION_SOURCE } from \"../JSInjection/constants\";\nimport { checkLanguageSupport, setUserInLocalStorage } from \"./functions\";\nimport { StyledPrimaryButton } from \"../JSInjection/Modal/Buttons.styles\";\nimport { API_URL, WEB_URL } from \"../../../../src/config\";\nimport { BROWSER_API } from \"../utils/browserApi\";\n\n//for isProbablyReadable options object\nconst minLength = 120;\nconst minScore = 20;\n\nexport default function Popup({ loggedIn }) {\n  let api = new Zeeguu_API(API_URL);\n\n  const [user, setUser] = useState();\n  const [tab, setTab] = useState();\n  const [isReadable, setIsReadable] = useState();\n  const [languageSupported, setLanguageSupported] = useState();\n\n  useEffect(() => {\n    if (loggedIn) {\n      getUserInfo(WEB_URL, setUser);\n    }\n  }, [loggedIn]);\n\n  useEffect(() => {\n    setUserInLocalStorage(user, api);\n  }, [user]);\n\n  useEffect(() => {\n    BROWSER_API.tabs.query({ active: true, currentWindow: true }, (tabs) => {\n      setTab(tabs[0]);\n    });\n  }, []);\n\n  useEffect(() => {\n    if (tab !== undefined && user !== undefined) {\n      api.session = user.session;\n      api.logUserActivity(api.OPEN_POPUP, \"\", tab.url, EXTENSION_SOURCE);\n\n      // Readability check and language check\n      const documentFromTab = getSourceAsDOM(tab.url);\n      const isProbablyReadable = isProbablyReaderable(\n        documentFromTab,\n        minLength,\n        minScore,\n      );\n      const ownIsProbablyReadable = checkReadability(tab.url);\n      if (!isProbablyReadable || !ownIsProbablyReadable) {\n        setIsReadable(false);\n        setLanguageSupported(false);\n      } else {\n        setIsReadable(true);\n        api.session = user.session;\n        if (api.session !== undefined) {\n          checkLanguageSupport(api, tab, setLanguageSupported);\n        }\n      }\n    }\n  }, [tab, user]);\n\n  const openLogin = () => {\n    window.open(WEB_URL + \"/log_in\", \"_blank\");\n  };\n\n  if (loggedIn === false) {\n    return (\n      <PopUp>\n        <HeadingContainer>\n          <img src={logo} alt=\"Zeeguu logo\" />\n        </HeadingContainer>\n        <BottomContainer>\n          <StyledPrimaryButton\n            onClick={openLogin}\n            name=\"toLogin\"\n            className=\"toLoginButton\"\n          >\n            Login\n          </StyledPrimaryButton>\n        </BottomContainer>\n      </PopUp>\n    );\n  } else {\n    if (user === undefined || isReadable === undefined) {\n      return null;\n    } else {\n      return (\n        <PopUp>\n          <PopupContent\n            isReadable={isReadable}\n            languageSupported={languageSupported}\n            user={user}\n            tab={tab}\n            api={api}\n            sessionId={user.session}\n          ></PopupContent>\n        </PopUp>\n      );\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}